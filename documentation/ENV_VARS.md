# Environment Variables Reference

> **Last Updated:** December 18, 2025
> **Single Source:** `.env` at project root (for local Docker development)
> **Deployed Environments:** Railway dashboard (backend) / Vercel dashboard (frontend)

---

## Quick Reference

| Environment | Configuration Location |
|-------------|----------------------|
| Local Docker | `.env` (project root) |
| Railway Backend | Railway dashboard → Variables |
| Vercel Frontend | Vercel dashboard → Environment Variables |

---

## Variable Categories

### Database (PostgreSQL)

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `POSTGRES_USER` | Yes | Docker | PostgreSQL username |
| `POSTGRES_PASSWORD` | Yes | Docker | PostgreSQL password |
| `POSTGRES_DB` | Yes | Docker | Database name |
| `DATABASE_URL` | Railway only | Backend | Full connection string (auto-generated by Railway) |

**Local Docker default:**
```bash
POSTGRES_USER=njstars
POSTGRES_PASSWORD=<your-password>
POSTGRES_DB=njstars
```

---

### Django Backend

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `SECRET_KEY` | Yes | Backend | Django secret key for cryptographic signing |
| `DEBUG` | No | Backend | Debug mode (default: False) |
| `ALLOWED_HOSTS` | No | Backend | Comma-separated list of allowed hosts |
| `DJANGO_SETTINGS_MODULE` | No | Backend | Settings module path |

**Local Docker default:**
```bash
SECRET_KEY=<generate-with-openssl-rand-hex-32>
DEBUG=True
```

**Generate a secret key:**
```bash
openssl rand -hex 32
```

---

### Stripe Payments

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `STRIPE_SECRET_KEY` | Yes | Backend | Stripe secret API key (sk_test_* or sk_live_*) |
| `STRIPE_PUBLISHABLE_KEY` | Yes | Both | Stripe publishable key (pk_test_* or pk_live_*) |
| `STRIPE_WEBHOOK_SECRET` | Yes | Backend | Webhook signing secret (whsec_*) |

**Local Docker default:**
```bash
# Use test keys for development
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
```

**Frontend mapping:**
- `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` is set from `STRIPE_PUBLISHABLE_KEY` in docker-compose.yml

**Production note:** Replace test keys with live keys in Railway/Vercel dashboards.

---

### NextAuth Authentication

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `NEXTAUTH_SECRET` | Yes | Frontend | Secret for NextAuth.js session encryption |
| `NEXTAUTH_URL` | Yes | Frontend | Canonical URL of the site |

**Local Docker default:**
```bash
NEXTAUTH_SECRET=<generate-with-openssl-rand-base64-32>
NEXTAUTH_URL=http://localhost:3000
```

**Generate NextAuth secret:**
```bash
openssl rand -base64 32
```

---

### OAuth Providers

#### Google OAuth

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `GOOGLE_CLIENT_ID` | Optional | Both | Google OAuth client ID |
| `GOOGLE_CLIENT_SECRET` | Optional | Both | Google OAuth client secret |

**Setup:** Create credentials at [Google Cloud Console](https://console.cloud.google.com/apis/credentials)

#### Facebook OAuth

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `FACEBOOK_CLIENT_ID` | Optional | Frontend | Facebook app ID |
| `FACEBOOK_CLIENT_SECRET` | Optional | Frontend | Facebook app secret |

#### Apple OAuth

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `APPLE_CLIENT_ID` | Optional | Frontend | Apple service ID |
| `APPLE_CLIENT_SECRET` | Optional | Frontend | Apple key file content |

---

### Google Sheets Export

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `GOOGLE_SHEETS_ENABLED` | Optional | Backend | Enable/disable Sheets export (default: true) |
| `GOOGLE_OAUTH_REDIRECT_URI` | Optional | Backend | OAuth callback URL for user-based export |

**Credentials file:** `backend/google-credentials.json` (gitignored)

The service account JSON is stored as a file, not an environment variable. Docker-compose mounts it automatically:
```yaml
GOOGLE_SERVICE_ACCOUNT_FILE: /app/google-credentials.json
```

---

### Google Maps

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `NEXT_PUBLIC_GOOGLE_MAPS_API_KEY` | Optional | Frontend | Google Maps API key for location features |

---

### Instagram Integration

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `INSTAGRAM_ACCESS_TOKEN` | Optional | Backend | Instagram Graph API access token |
| `INSTAGRAM_BUSINESS_ACCOUNT_ID` | Optional | Backend | Instagram Business Account ID |
| `META_APP_ID` | Optional | Backend | Meta (Facebook) App ID |
| `META_APP_SECRET` | Optional | Backend | Meta App Secret |

**Note:** If not set, the app uses mock Instagram data for development.

---

### Printify (Print-on-Demand)

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `PRINTIFY_API_KEY` | Optional | Backend | Printify API token |
| `PRINTIFY_SHOP_ID` | Optional | Backend | Printify shop identifier |
| `PRINTIFY_WEBHOOK_SECRET` | Optional | Backend | Webhook verification secret |
| `PRINTIFY_DRY_RUN` | Optional | Backend | Skip API calls in development (default: false) |

---

### Email (SendGrid)

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `SENDGRID_API_KEY` | Production | Backend | SendGrid API key for transactional emails |

**Local Docker:** Uses MailHog (no API key needed). View emails at http://localhost:8025

---

### Vercel AI (Optional)

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `VERCEL_AI_API_KEY` | Optional | Frontend | Vercel AI SDK API key |

---

### Frontend URLs

| Variable | Required | Used By | Description |
|----------|----------|---------|-------------|
| `FRONTEND_URL` | Yes | Backend | Frontend URL for CORS and redirects |
| `NEXT_PUBLIC_API_URL` | Yes | Frontend | Backend API URL (public, for browser) |
| `INTERNAL_API_URL` | Docker only | Frontend | Backend URL for server-side requests |

**Local Docker default:**
```bash
FRONTEND_URL=http://localhost:3000
NEXT_PUBLIC_API_URL=http://localhost:8000
# INTERNAL_API_URL is set in docker-compose.yml to http://backend:8000
```

---

## Environment-Specific Configuration

### Local Docker Development

Single `.env` file at project root with all variables. Start with:
```bash
cp .env.example .env
# Edit .env with your values
make up
```

### Railway (Backend Production)

Set these in Railway dashboard → Your Project → Variables:

**Required:**
- `SECRET_KEY`
- `STRIPE_SECRET_KEY` (live key)
- `STRIPE_PUBLISHABLE_KEY` (live key)
- `STRIPE_WEBHOOK_SECRET`
- `FRONTEND_URL` (e.g., https://njstarselite.com)
- `SENDGRID_API_KEY`

**Auto-provided by Railway:**
- `DATABASE_URL` (from PostgreSQL plugin)

**Optional but recommended:**
- `CLOUDINARY_CLOUD_NAME`, `CLOUDINARY_API_KEY`, `CLOUDINARY_API_SECRET` (media storage)
- `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET` (OAuth)
- `PRINTIFY_*` (if using POD)
- `INSTAGRAM_*` (if using live feed)

### Vercel (Frontend Production)

Set these in Vercel dashboard → Your Project → Settings → Environment Variables:

**Required:**
- `NEXT_PUBLIC_API_URL` (e.g., https://api.njstarselite.com)
- `NEXTAUTH_URL` (e.g., https://njstarselite.com)
- `NEXTAUTH_SECRET`
- `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` (live key)

**Optional:**
- `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`
- `NEXT_PUBLIC_GOOGLE_MAPS_API_KEY`
- `FACEBOOK_CLIENT_ID`, `FACEBOOK_CLIENT_SECRET`

---

## Security Notes

1. **Never commit secrets** - All `.env` files are gitignored
2. **Rotate compromised keys** - If a key is exposed, rotate it immediately
3. **Use test keys locally** - Never use live Stripe keys in development
4. **File-based credentials** - Google service account JSON stored as file, not env var
5. **Platform dashboards for production** - No `.env` files on deployed servers

---

## Troubleshooting

### Docker can't find variables
1. Ensure `.env` exists at project root
2. Run `make down && make up` to reload

### Frontend can't reach backend
1. Check `NEXT_PUBLIC_API_URL` is set correctly
2. For Docker: should be `http://localhost:8000`
3. For production: should be your API domain

### Stripe webhook failures
1. For local dev: Run `stripe listen --forward-to localhost:8000/api/payments/webhook/stripe/`
2. Update `STRIPE_WEBHOOK_SECRET` with the output secret

### Google Sheets export not working
1. Ensure `backend/google-credentials.json` exists
2. Check file is valid JSON with service account credentials
3. Verify `GOOGLE_SHEETS_ENABLED=true`
