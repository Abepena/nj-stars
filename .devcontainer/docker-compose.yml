version: '3.8'

services:
  devcontainer:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      # Mount the workspace
      - ..:/workspace:cached
      # Persist VS Code extensions
      - vscode-extensions:/home/vscode/.vscode-server/extensions
      # Persist command history
      - bash-history:/commandhistory
      # Docker socket for Docker-in-Docker
      - /var/run/docker.sock:/var/run/docker.sock

    # Keep container running
    command: sleep infinity

    # Network mode for accessing host services
    network_mode: host

    # Required for Docker-in-Docker
    privileged: true

    environment:
      # Development environment markers
      - CODESPACES=true
      - DEVCONTAINER=true

volumes:
  vscode-extensions:
  bash-history:
